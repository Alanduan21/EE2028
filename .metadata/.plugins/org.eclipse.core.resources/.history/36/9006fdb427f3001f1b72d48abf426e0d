/*
 * asm_func.s
 *
 *  Created on: 7/2/2025
 *      Author: Hou Linxin
 */
   .syntax unified
	.cpu cortex-m4
	.fpu softvfp
	.thumb

		.global asm_func

@ Start of executable code
.section .text

@ CG/[T]EE2028 Assignment 1, Sem 2, AY 2024/25
@ (c) ECE NUS, 2025

@ Write Student 1’s Name here:LI XIAOYANG
@ Write Student 2’s Name here:DUAN YIHE

@ Look-up table for registers:

@ R0 building array pointer
@ R1 entry array pointer
@ R2 exit array pointer
@ R3 result array poiner
@ R4 each entry in sumEntries;each section car count in insert
@ R5 how much a section is left with
@ R6 loop counters reused in both sumEntries loop and insert loop
@ R7 sum of all entries
@ R8 limit 12 of each section
@ R9 each section exit
@ R10 stores F*S, which should be counter number
@ R11 stores S;

@ write your program from here:

asm_func:
 	PUSH {R4-R12,R14}
 	@my code

	@ get F&S
	LDR R10,[R3] @ load F from result
	LDR R11,[R3,#4] @ load S from result
	MUL R10, R10,R11 @ @ Compute F * S (total sections)

	MOV R6, R4 @ counter
	MOV R7, #0

sumEntries:
		LDR R12, [R1], #4 @ load entries to R4
		ADD R7, R4 @ R7 is SUM of total entries
		SUBS R6, #1
		BNE sumEntries

		MOV R6, R10  @ counter (with F*S)
		MOV R8, #12 @ LIMIT

insert:
		LDR R12, [R0], #4 @ section amount NO.
		LDR R9, [R2], #4 @ each section's EXIT
		SUB R5, R8, R12 @ R5 is LEFT_WITH
		CMP R7, R5 @ compare SUM-LEFT_WITH
		BHI SumMoreThanLeftWith@ if SUM > LEFT_WITH
		B SumLessThanLeftWith

		@ change into different loops

SumMoreThanLeftWith:
		SUB R12, R8, R9 @ 12 - EXIT stored in R4
		SUB R7, R5 @ update SUM
		B continueLoop


SumLessThanLeftWith:

		ADD R12, R7 @ all SUM remained enter current section
		SUB R12, R9 @ result after substracting EXIT
		MOV R7, #0 @ clear SUM
		B continueLoop

continueLoop:

		SUBS R6, #1
		STR R12, [R3], #4 @ store result
		BNE insert


 	POP {R4-R12,R14}

	BX LR
